<ul>
    {% for rule in module.children %}
    <!-- <button type="button" data-toggle="collapse" data-target="#rule-{{rule.id}}">{{ rule.explanation }}</button> -->
    <div class="accordion" id="accordion-{{rule.id}}">
      <div class="card">
        <div class="card-header" id="heading-{{rule.id}}">
          <a data-toggle="collapse" data-parent="#accordion-{{rule.id}}" href="#rule-{{rule.id}}" aria-expanded="true" aria-controls="rule-{{rule.id}}">
            <h5 class="mb-0">
              {{ rule.explanation }}
              <i class="fas fa-angle-down rotate-icon"></i>
            </h5>
          </a>
        </div>

        <div id="rule-{{rule.id}}" class="collapse" role="tabpanel" aria-labelledby="heading-{{rule.id}}" data-parent="#accordion-{{rule.id}}">
          <div class="card-body">
            <li>
                {% if rule.is_bundled %}
                    Part of bundled policy: {{ rule.bundle.explanation }}<BR>
                {% endif %}
                <label>Filter Code: </label>
                <textarea id="filter_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                <label>Init Code: </label>
                <textarea id="init_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                <label>Notify Code: </label>
                <textarea id="notify_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                <label>Conditional Code: </label>
                <textarea id="conditional_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                <label>Action Code: </label>
                <textarea id="action_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                <label>Failure Code: </label>
                <textarea id="failure_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}"></textarea> <BR>
                {{ rule.policy_text }} <BR>
                <i>{{ rule.explanation }}</i>
            </li>
            <script>
                var codeTypes = {
                    'filter': `{{ rule.policy_filter_code | safe }}`, 
                    'init': `{{ rule.policy_init_code | safe }}`, 
                    'notify': `{{ rule.policy_notify_code | safe }}`, 
                    'conditional': `{{ rule.policy_conditional_code | safe }}`, 
                    'action': `{{ rule.policy_action_code | safe }}`, 
                    'failure': `{{ rule.policy_failure_code | safe }}`
                };

                for (var type in codeTypes) {
                    var textArea = document.getElementById(type + '_{{rule.policy_type}}_{{rule.status}}_{{ rule.id }}');
                    var editor = CodeMirror.fromTextArea(textArea, {
                      lineNumbers: true,
                      readOnly: "nocursor"
                    });
                    editor.setValue(codeTypes[type]);
                    editor.refresh();
                }
            </script>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
</ul>