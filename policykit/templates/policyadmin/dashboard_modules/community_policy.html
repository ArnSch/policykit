{% load humanize %}


<ul>
			{% for rule in module.children %}
			<li>
					{% if rule.is_bundled %}
						Part of bundled policy: {{ rule.bundle.explanation }}<BR>
					{% endif %}
                    <label>Filter Code: </label>
                    <textarea id="filter_{{ rule.id }}"></textarea> <BR>
                    <label>Init Code: </label>
                    <textarea id="init_{{ rule.id }}"></textarea> <BR>
                    <label>Notify Code: </label>
                    <textarea id="notify_{{ rule.id }}"></textarea> <BR>
                    <label>Conditional Code: </label>
                    <textarea id="conditional_{{ rule.id }}"></textarea> <BR>
                    <label>Action Code: </label>
                    <textarea id="action_{{ rule.id }}"></textarea> <BR>
                    <label>Failure Code: </label>
                    <textarea id="failure_{{ rule.id }}"></textarea> <BR>
					{{ rule.policy_text }} <BR>
					<i>{{ rule.explanation }}</i>
				</li>

            <script>
                const codeTypes = {
                    'filter': `{{ rule.policy_filter_code | safe }}`, 
                    'init': `{{ rule.policy_init_code | safe }}`, 
                    'notify': `{{ rule.policy_notify_code | safe }}`, 
                    'conditional': `{{ rule.policy_conditional_code | safe }}`, 
                    'action': `{{ rule.policy_action_code | safe }}`, 
                    'failure': `{{ rule.policy_failure_code | safe }}`
                };

                for (const type in codeTypes) {
                    var textArea = document.getElementById(type + '_{{ rule.id }}');
                    var editor = CodeMirror.fromTextArea(textArea, {
                      lineNumbers: true,
                      readOnly: "nocursor"
                    });
                    editor.setValue(codeTypes[type]);
                }
            </script>
			{% endfor %}
</ul>